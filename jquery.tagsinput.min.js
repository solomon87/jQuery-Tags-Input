(function(c){var a=[],b=[];c.fn.doAutosize=function(h){var f=c(this).data("minwidth"),n=c(this).data("maxwidth"),j="",m=c(this),i=c("#"+c(this).data("tester_id"));if(j===(j=m.val())){return}var e=j.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");i.html(e);var l=i.width(),k=(l+h.comfortZone)>=f?l+h.comfortZone:f,g=m.width(),d=(k<g&&k>=f)||(k>f&&k<n);if(d){m.width(k)}};c.fn.resetAutosize=function(f){var h=c(this).data("minwidth")||f.minInputWidth||c(this).width(),i=c(this).data("maxwidth")||f.maxInputWidth||(c(this).closest(".tagsinput").width()-f.inputPadding),e=c(this),g=c("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:e.css("fontSize"),fontFamily:e.css("fontFamily"),fontWeight:e.css("fontWeight"),letterSpacing:e.css("letterSpacing"),whiteSpace:"nowrap"}),d=c(this).attr("id")+"_autosize_tester";if(c("#"+d).length>=0){g.attr("id",d);g.appendTo("body")}e.data("minwidth",h);e.data("maxwidth",i);e.data("tester_id",d);e.css("width",h)};c.fn.addTag=function(e,d){d=jQuery.extend({focus:false,callback:true},d);this.each(function(){var m=c(this).attr("id"),k=c("#"+m+"_tag"),h,l,j;var g=c(this).val().split(a[m]);if(g[0]===""){g=[]}e=jQuery.trim(e);if(d.unique){h=c(this).tagExist(e);if(h===true){k.addClass("not_valid")}}else{h=false}if(e!==""&&h!==true){c("<span>").addClass("tag").append(c("<span>").text(e).append("&nbsp;&nbsp;"),c("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return c("#"+m).removeTag(escape(e))})).insertBefore("#"+m+"_addTag");g.push(e);k.val("");if(d.focus){k.focus()}else{k.blur()}c.fn.tagsInput.updateTagsField(this,g);if(d.callback&&b[m]&&b[m].onAddTag){l=b[m].onAddTag;l.call(this,e)}if(b[m]&&b[m].onChange){j=g.length;l=b[m].onChange;l.call(this,c(this),g[j-1])}}});return false};c.fn.removeTag=function(d){d=unescape(d);this.each(function(){var k=c(this).attr("id"),e=c(this).val().split(a[k]),j="",g;c("#"+k+"_tagsinput .tag").remove();for(g=0;g<e.length;g++){if(e[g]!==d){j=j+a[k]+e[g]}}c.fn.tagsInput.importTags(this,j);if(b[k]&&b[k].onRemoveTag){var h=b[k].onRemoveTag;h.call(this,d)}});return false};c.fn.tagExist=function(e){var f=c(this).attr("id");var d=c(this).val().split(a[f]);return(jQuery.inArray(e,d)>=0)};c.fn.importTags=function(d){var e=c(this).attr("id");c("#"+e+"_tagsinput .tag").remove();c.fn.tagsInput.importTags(this,d)};c.fn.tagsInput=function(d){var e=jQuery.extend({interactive:true,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:false},hide:true,delimiter:",",unique:true,removeWithBackspace:true,placeholderColor:"#666666",autosize:true,comfortZone:20,inputPadding:6*2},d);this.each(function(){if(e.hide){c(this).hide()}var i=c(this).attr("id");if(!i||a[c(this).attr("id")]){i=c(this).attr("id","tags"+new Date().getTime()).attr("id")}var g=jQuery.extend({pid:i,real_input:c(this),holder:c('<div id="'+i+'_tagsinput" class="tagsinput"/>'),input_wrapper:c('<div id="'+i+'_addTag"/>'),fake_input:c('<input id="'+i+'_tag" value="" data-default="'+e.defaultText+'" />')},e);a[i]=g.delimiter;if(e.onAddTag||e.onRemoveTag||e.onChange){b[i]=[];b[i].onAddTag=e.onAddTag;b[i].onRemoveTag=e.onRemoveTag;b[i].onChange=e.onChange}g.holder.append(g.input_wrapper.append(g.fake_input)).append(c('<div class="tags_clear">')).insertAfter(this);g.holder.css("width",e.width);g.holder.css("min-height",e.height);g.holder.css("height","100%");if(g.real_input.val()!==""){c.fn.tagsInput.importTags(g.real_input,g.real_input.val())}if(e.interactive){g.fake_input.val(g.fake_input.attr("data-default"));g.fake_input.css("color",e.placeholderColor);g.fake_input.resetAutosize(e);g.fake_input.doAutosize(e);g.holder.bind("click",g,function(j){j.data.fake_input.focus()});g.fake_input.bind("focus",g,function(j){if(j.data.fake_input.val()===j.data.fake_input.attr("data-default")){j.data.fake_input.val("")}j.data.fake_input.css("color","#000000")});if(e.autocomplete_url!==undefined){var h={source:e.autocomplete_url};for(var f in e.autocomplete){if(e.autocomplete.hasOwnProperty(f)){h[f]=e.autocomplete[f]}}if(jQuery.Autocompleter!==undefined){g.fake_input.autocomplete(e.autocomplete_url,e.autocomplete);g.fake_input.bind("result",g,function(j,k){if(k){c("#"+i).addTag(k[0]+"",{focus:true,unique:(e.unique)})}})}else{if(jQuery.ui.autocomplete!==undefined){g.fake_input.autocomplete(h);g.fake_input.bind("autocompleteselect",g,function(j,k){j.data.real_input.addTag(k.item.value,{focus:true,unique:(e.unique)});return false})}}}else{g.fake_input.bind("blur",g,function(j){var k=c(this).attr("data-default");if(j.data.fake_input.val()!==""&&j.data.fake_input.val()!==k){if((j.data.minChars<=j.data.fake_input.val().length)&&(!j.data.maxChars||(j.data.maxChars>=j.data.fake_input.val().length))){j.data.real_input.addTag(j.data.fake_input.val(),{focus:false,unique:(e.unique)})}}else{j.data.fake_input.val(j.data.fake_input.attr("data-default"));j.data.fake_input.css("color",e.placeholderColor)}j.data.fake_input.doAutosize(e);return false})}g.fake_input.bind("keypress",g,function(j){if(j.which===j.data.delimiter.charCodeAt(0)||j.which===13){j.preventDefault();if((j.data.minChars<=j.data.fake_input.val().length)&&(!j.data.maxChars||(j.data.maxChars>=j.data.fake_input.val().length))){j.data.real_input.addTag(j.data.fake_input.val(),{focus:true,unique:(e.unique)})}j.data.fake_input.resetAutosize(e);return false}else{if(j.data.autosize){j.data.fake_input.doAutosize(e)}}return true});if(g.removeWithBackspace){g.fake_input.bind("keydown",function(k){if(k.keyCode===8&&c(this).val()===""){k.preventDefault();var j=c(this).closest(".tagsinput").find(".tag:last").text();var l=c(this).attr("id").replace(/_tag$/,"");j=j.replace(/[\s]+x$/,"");c("#"+l).removeTag(escape(j));c(this).trigger("focus")}})}g.fake_input.blur();if(g.unique){g.fake_input.keydown(function(j){if(j.keyCode===8||String.fromCharCode(j.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,\/]+/)){c(this).removeClass("not_valid")}})}}});return this};c.fn.tagsInput.updateTagsField=function(e,d){var f=c(e).attr("id");c(e).val(d.join(a[f]))};c.fn.tagsInput.importTags=function(h,j){c(h).val("");var k=c(h).attr("id");var d=j.split(a[k]);for(var e=0;e<d.length;e++){c(h).addTag(d[e],{focus:false,callback:false})}if(b[k]&&b[k].onChange){var g=b[k].onChange;g.call(h,h,d[e])}}})(jQuery);